{
  "apiVersion": 1,
  "groups": [
    {
      "orgId": 1,
      "name": "Tip Router Claims Progress",
      "folder": "Tip Router Alerts",
      "interval": "5m",
      "rules": [
        {
          "uid": "claims_progress_stalled",
          "title": "Claims Progress Stalled",
          "condition": "E",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": { "from": 172800, "to": 0 },
              "datasourceUid": "eeaeqrzm41logf",
              "model": {
                "datasource": { "type": "influxdb", "uid": "eeaeqrzm41logf" },
                "query": "SELECT \"claim_transactions_left\" FROM \"tip_router_cli.claim_mev_tips-send_summary\" WHERE time >= now() - 2d AND time <= now() GROUP BY \"epoch\"::field",
                "refId": "A",
                "resultFormat": "time_series"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": { "from": 172800, "to": 3600 },
              "datasourceUid": "eeaeqrzm41logf",
              "model": {
                "datasource": { "type": "influxdb", "uid": "eeaeqrzm41logf" },
                "query": "SELECT \"claim_transactions_left\" FROM \"tip_router_cli.claim_mev_tips-send_summary\" WHERE time >= now() - 2d AND time <= now() - 1h GROUP BY \"epoch\"::field",
                "refId": "B",
                "resultFormat": "time_series"
              }
            },
            {
              "refId": "C",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "A",
                "intervalMs": 1000,
                "maxDataPoints": 1000,
                "reducer": "last",
                "refId": "C",
                "type": "reduce"
              }
            },
            {
              "refId": "D",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "B",
                "intervalMs": 1000,
                "maxDataPoints": 1000,
                "reducer": "last",
                "refId": "D",
                "type": "reduce"
              }
            },
            {
              "refId": "E",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "$C == $D && $C > 0",
                "intervalMs": 1000,
                "maxDataPoints": 1000,
                "refId": "E",
                "type": "math"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "2h",
          "keepFiringFor": "0s",
          "annotations": {
            "description": "Claims progress has stalled for epoch {{ $labels.epoch }}. Current outstanding claims: {{ $values.C.Value }}. Claims 1 hour ago: {{ $values.D.Value }}. No progress made in the last 1 hour.",
            "summary": "Tip Router claims processing appears to be stuck"
          },
          "labels": {
            "severity": "warning"
          },
          "isPaused": false
        },
        {
          "uid": "claims_completion_delay",
          "title": "Claims Taking Too Long to Complete",
          "condition": "D",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": { "from": 604800, "to": 0 },
              "datasourceUid": "eeaeqrzm41logf",
              "model": {
                "datasource": { "type": "influxdb", "uid": "eeaeqrzm41logf" },
                "groupBy": [{ "params": ["epoch"], "type": "tag" }],
                "measurement": "tip_router_cli.claim_mev_tips-send_summary",
                "orderByTime": "ASC",
                "policy": "default",
                "refId": "A",
                "resultFormat": "time_series",
                "select": [[{ "params": ["claim_transactions_left"], "type": "field" }]],
                "tags": []
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "A",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "reducer": "last",
                "refId": "B",
                "type": "reduce"
              }
            },
            {
              "refId": "C",
              "relativeTimeRange": { "from": 604800, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "A",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "reducer": "first",
                "refId": "C",
                "type": "reduce"
              }
            },
            {
              "refId": "D",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "$B > 0 && $C > 0",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "D",
                "type": "math"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "18h",
          "keepFiringFor": "0s",
          "annotations": {
            "description": "Claims for epoch {{ $labels.epoch }} have been running for over 18 hours. Outstanding claims: {{ $values.B.Value }}. Initial claims: {{ $values.C.Value }}.",
            "summary": "Tip Router claims processing is taking unusually long"
          },
          "labels": {
            "severity": "critical"
          },
          "isPaused": false
        },
        {
          "uid": "claims_completed_successfully",
          "title": "Claims Completed Successfully",
          "condition": "C",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": { "from": 604800, "to": 0 },
              "datasourceUid": "eeaeqrzm41logf",
              "model": {
                "datasource": { "type": "influxdb", "uid": "eeaeqrzm41logf" },
                "groupBy": [{ "params": ["epoch"], "type": "tag" }],
                "measurement": "tip_router_cli.claim_mev_tips-send_summary",
                "orderByTime": "ASC",
                "policy": "default",
                "refId": "A",
                "resultFormat": "time_series",
                "select": [[{ "params": ["claim_transactions_left"], "type": "field" }]],
                "tags": []
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "A",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "reducer": "last",
                "refId": "B",
                "type": "reduce"
              }
            },
            {
              "refId": "C",
              "relativeTimeRange": { "from": 0, "to": 0 },
              "datasourceUid": "__expr__",
              "model": {
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "$B == 0",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "C",
                "type": "math"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "keepFiringFor": "0s",
          "annotations": {
            "description": "All claims for epoch {{ $labels.epoch }} have been successfully completed. Outstanding claims: {{ $values.B.Value }}.",
            "summary": "Tip Router claims processing completed successfully"
          },
          "labels": {
            "severity": "info"
          },
          "isPaused": false
        }
      ]
    }
  ]
}